# SDC-STOCK 부스 모드 PRD (Product Requirements Document)

## 1. 개요

### 1.1 프로젝트 배경
SDC-STOCK 주식 게임을 오프라인 부스 행사에서 대규모(100명+) 참여자가 동시에 즐길 수 있도록 하는 특별 모드 개발

### 1.2 목표
- 부스 환경에서 로그인 없이 즉시 게임 참여 가능
- 매시간 토너먼트 형식의 게임 운영 지원
- 현장 상품 전달을 위한 우승자 식별 용이성

### 1.3 핵심 원칙
- **최소 개발**: 기존 시스템 최대한 활용
- **간편한 참여**: 복잡한 인증 과정 제거
- **명확한 식별**: 닉네임 기반 우승자 구분

## 2. 사용자 스토리

### 2.1 부스 참여자 (Primary User)
```
AS A 부스 방문객
I WANT TO QR 코드 스캔 후 닉네임만 입력하여 게임 참여
SO THAT 복잡한 가입 절차 없이 즉시 게임을 즐길 수 있다
```

### 2.2 스태프 (Secondary User)
```
AS A 부스 운영 스태프
I WANT TO 매시간 새로운 게임 세션을 생성하고 관리
SO THAT 시간대별 토너먼트를 원활하게 운영할 수 있다
```

### 2.3 기존 사용자 (Optional User)
```
AS A 기존 SDC-STOCK 사용자
I WANT TO 내 계정으로 로그인하여 참여
SO THAT 게임 기록을 보존하고 싶을 때 선택할 수 있다
```

## 3. 기능 요구사항

### 3.1 부스 모드 활성화
- **환경변수 기반**: `VITE_BOOTH_MODE=true`로 부스 전용 빌드 생성
- **조건적 활성화**: 부스 빌드에서만 특별 기능 노출

### 3.2 진입점 분기
#### 3.2.1 부스 모드 진입 화면
- 게스트 참여 옵션 (주요)
- 계정 로그인 옵션 (보조)
- 모바일 최적화 UI

#### 3.2.2 게스트 참여 플로우
1. "게스트로 참여" 버튼 클릭
2. 닉네임 입력 모달 표시
3. 실시간 중복 검증
4. 참여 완료

#### 3.2.3 계정 로그인 플로우
1. "계정으로 로그인" 버튼 클릭
2. 기존 Supabase 인증 플로우
3. 프로필 자동 사용

### 3.3 닉네임 관리
- **중복 불가**: 파티 내 유니크 보장
- **실시간 검증**: 입력 중 즉시 피드백
- **에러 메시지**: "이미 사용 중인 닉네임입니다"
- **타임스탬프 미사용**: 현장 식별 명확성 우선

### 3.4 Screen 페이지 개선
- **QR 코드**: 파티 직접 참여 링크 (`/party/:partyId`)
- **게임 상태 표시**: 대기/진행/종료 구분
- **우승자 발표**: 게임 종료 시 명확한 표시

## 4. 기술 사양

### 4.1 아키텍처
```
Frontend (부스 빌드)
    ├── 환경변수 감지 (VITE_BOOTH_MODE)
    ├── 조건부 인증 우회
    └── 게스트 참여 컴포넌트

Backend (변경 없음)
    └── 기존 API 그대로 사용
```

### 4.2 데이터 플로우
```typescript
// 게스트 참여 시
1. nickname 입력
2. userId = `booth_${nickname}` 생성
3. POST /party/join { partyId, userId }
4. 게임 데이터는 DynamoDB에 저장
5. 세션 종료 후 자동 정리
```

### 4.3 컴포넌트 구조
```
BoothModeEntry (신규)
├── GuestLoginButton
├── AccountLoginButton
└── BoothNicknameModal (신규)
    ├── NicknameInput
    ├── ValidationFeedback
    └── SubmitButton
```

## 5. 구현 계획

### Phase 1: 환경 설정 (30분)
- [ ] `.env.booth` 파일 생성
- [ ] `package.json`에 `build:booth` 스크립트 추가
- [ ] Vite 설정에서 환경변수 처리

### Phase 2: 부스 모드 진입점 (1시간)
- [ ] `BoothModeEntry` 컴포넌트 개발
- [ ] 게스트/계정 선택 UI 구현
- [ ] `SupabaseProvider` 조건부 렌더링 로직

### Phase 3: 닉네임 시스템 (1시간)
- [ ] `BoothNicknameModal` 컴포넌트 개발
- [ ] 실시간 중복 검증 API 연동
- [ ] 에러 처리 및 피드백 UI

### Phase 4: Screen 페이지 개선 (30분)
- [ ] QR 코드 링크 수정
- [ ] 우승자 발표 화면 추가 (선택)

### Phase 5: 테스트 및 검증 (30분)
- [ ] 100명 동시 접속 시뮬레이션
- [ ] 닉네임 중복 검증 테스트
- [ ] 게임 플로우 E2E 테스트

## 6. 비기능 요구사항

### 6.1 성능
- 100명+ 동시 접속 지원
- 1.5초 polling 간격 유지
- 모바일 네트워크 환경 고려

### 6.2 사용성
- 3단계 이내 게임 참여
- 5초 이내 닉네임 검증
- 직관적인 UI/UX

### 6.3 호환성
- 기존 시스템과 100% 호환
- Backend API 변경 없음
- 데이터 스키마 변경 없음

## 7. 제약사항

### 7.1 범위 제한
- Frontend만 수정 (Backend 변경 불가)
- 새로운 데이터베이스 테이블 생성 불가
- 기존 인증 시스템 수정 불가

### 7.2 기술 제약
- React + Vite 환경
- Tanstack Query 기반 상태 관리
- DynamoDB 기존 스키마 유지

## 8. 성공 지표

### 8.1 정량적 지표
- 게임 참여 소요 시간: < 30초
- 동시 접속자 수: 100명+
- 닉네임 검증 응답 시간: < 1초

### 8.2 정성적 지표
- 부스 참여자 만족도
- 운영 스태프 편의성
- 우승자 식별 명확성

## 9. 리스크 및 대응

### 9.1 기술적 리스크
| 리스크 | 영향도 | 대응 방안 |
|--------|--------|-----------|
| 닉네임 중복 검증 실패 | 높음 | 프론트엔드 캐싱 및 디바운싱 |
| 100명 동시 접속 부하 | 중간 | Polling 간격 동적 조정 |
| 네트워크 불안정 | 낮음 | 재시도 로직 및 오프라인 감지 |

### 9.2 운영적 리스크
| 리스크 | 영향도 | 대응 방안 |
|--------|--------|-----------|
| 스태프 실수로 인한 게임 중단 | 중간 | 키보드 단축키 확인 절차 |
| QR 코드 스캔 실패 | 낮음 | 수동 URL 입력 대안 제공 |

## 10. 타임라인

### 개발 일정
- **Day 1 (3시간)**
  - 환경 설정 및 부스 모드 진입점 구현
  - 닉네임 시스템 개발

- **Day 2 (1시간)**
  - Screen 페이지 개선
  - 통합 테스트 및 버그 수정

### 배포 일정
- **부스 행사 D-3**: 스테이징 환경 배포
- **부스 행사 D-1**: 프로덕션 배포 및 최종 점검
- **부스 행사 D-Day**: 현장 운영 및 모니터링

## 11. 부록

### 11.1 화면 설계
```
[부스 모드 진입 화면]
┌─────────────────────────┐
│    SDC 부스 게임        │
│                         │
│  ┌──────────────────┐  │
│  │  🎮 게스트로 참여  │  │ <- 주요 CTA
│  │  닉네임만 입력    │  │
│  └──────────────────┘  │
│                         │
│  ┌──────────────────┐  │
│  │  🔐 계정 로그인   │  │ <- 보조 옵션
│  │  기존 계정 사용   │  │
│  └──────────────────┘  │
└─────────────────────────┘

[닉네임 입력 모달]
┌─────────────────────────┐
│   닉네임을 입력하세요    │
│                         │
│  ┌──────────────────┐  │
│  │                  │  │
│  └──────────────────┘  │
│   ✓ 사용 가능합니다     │
│                         │
│      [확인] [취소]      │
└─────────────────────────┘
```

### 11.2 API 명세
```typescript
// 기존 API 활용 (변경 없음)
POST /party/join
{
  partyId: string,
  userId: string  // booth_닉네임 형식
}

GET /stock/user/list?stockId={stockId}
// 닉네임 중복 검증용
```

### 11.3 환경변수 설정
```bash
# .env.booth
VITE_BOOTH_MODE=true
PUBLIC_SUPABASE_URL=xxx  # 기존 값 유지
PUBLIC_SUPABASE_KEY=xxx  # 기존 값 유지
```

---

*문서 버전: 1.0.0*
*작성일: 2024-12-XX*
*작성자: Claude Code Assistant*